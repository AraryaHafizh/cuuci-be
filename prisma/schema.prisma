generator client {
  provider = "prisma-client"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                String             @id @default(cuid())
  name              String
  email             String             @unique
  password          String
  role              Role               @default(CUSTOMER)
  phoneNumber       String             @default("")
  emailVerified     Boolean            @default(false)
  verifiedAt        DateTime?
  profilePictureUrl String?
  addresses         Address[]
  createdAt         DateTime           @default(now())
  updatedAt         DateTime           @updatedAt
  // Outlet admin relation
  outletAdmin       Outlet?            @relation(fields: [outletId], references: [id])
  outletId          String?
  // Worker relations
  workerShifts      WorkerShift[]
  // Customer orders
  orders            Order[]            @relation("CustomerOrders")
  // Driver relations
  drivers           Driver[]
  driverOrders      Order[]            @relation("DriverOrders")
  userTokens        UserToken[]
  attendances       Attendance[]
  userNotifications UserNotification[]

  @@map("users")
}

model UserToken {
  type   Token
  user   User   @relation(fields: [userId], references: [id])
  userId String
  token  String @unique

  @@map("user_tokens")
}

model Address {
  id        String   @id @default(cuid())
  user      User     @relation(fields: [userId], references: [id])
  userId    String
  address   String
  latitude  String
  longitude String
  isPrimary Boolean  @default(false)
  isDeleted Boolean  @default(false)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  orders    Order[]

  @@map("addresses")
}

model Outlet {
  id           String        @id @default(cuid())
  name         String
  address      String
  latitude     String
  longitude    String
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt
  orders       Order[]
  workerShifts WorkerShift[]
  userId       String?
  users        User[]
  drivers      Driver[]

  @@map("outlets")
}

model LaundryItem {
  id         String      @id @default(cuid())
  name       String
  createdAt  DateTime    @default(now())
  updatedAt  DateTime    @updatedAt
  orderItems OrderItem[]

  @@map("laundry_items")
}

model Order {
  id             String          @id @default(cuid())
  customer       User            @relation("CustomerOrders", fields: [customerId], references: [id])
  customerId     String
  outlet         Outlet          @relation(fields: [outletId], references: [id])
  outletId       String
  driver         User?           @relation("DriverOrders", fields: [driverId], references: [id])
  driverId       String?
  address        Address         @relation(fields: [addressId], references: [id])
  addressId      String
  status         OrderStatus
  totalPrice     Int
  totalWeight    Int
  distance       Int
  orderItems     OrderItem[]
  payment        Payment?
  createdAt      DateTime        @default(now())
  updatedAt      DateTime        @updatedAt
  pickupTime     DateTime?
  deliveryTime   DateTime?
  notes          String?
  invoiceUrl     String
  pickupOrders   PickupOrder[]
  deliveryOrders DeliveryOrder[]

  @@map("orders")
}

model OrderItem {
  id            String      @id @default(cuid())
  order         Order       @relation(fields: [orderId], references: [id])
  orderId       String
  laundryItem   LaundryItem @relation(fields: [laundryItemId], references: [id])
  laundryItemId String
  quantity      Int
  createdAt     DateTime    @default(now())
  updatedAt     DateTime    @updatedAt

  @@map("order_items")
}

model PickupOrder {
  id           String      @id @default(cuid())
  pickupNumber String      @unique
  status       OrderStatus
  driverId     String?     
  driver       Driver?     @relation(fields: [driverId], references: [id])
  orderId      String?     
  order        Order?      @relation(fields: [orderId], references: [id])
  createdAt    DateTime    @default(now())
  updatedAt    DateTime    @updatedAt

  @@map("pickup_orders")
}

model DeliveryOrder {
  id             String      @id @default(cuid())
  deliveryNumber String      @unique
  status         OrderStatus
  driverId       String?     
  driver         Driver?     @relation(fields: [driverId], references: [id])
  orderId        String?     
  order          Order?      @relation(fields: [orderId], references: [id])
  createdAt      DateTime    @default(now())
  updatedAt      DateTime    @updatedAt

  @@map("delivery_orders")
}

model Payment {
  id            String        @id @default(cuid())
  order         Order         @relation(fields: [orderId], references: [id])
  orderId       String        @unique
  invoiceNumber String        @unique
  invoiceUrl    String?
  amount        Int
  method        String
  status        PaymentStatus
  paidAt        DateTime?
  createdAt     DateTime      @default(now())
  updatedAt     DateTime      @updatedAt

  @@map("payments")
}

model Attendance {
  id        String    @id @default(cuid())
  user      User      @relation(fields: [userId], references: [id])
  userId    String
  checkIn   DateTime
  checkOut  DateTime?
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt

  @@map("attendances")
}

model WorkerShift {
  id        String    @id @default(cuid())
  worker    User      @relation(fields: [workerId], references: [id])
  workerId  String
  outlet    Outlet    @relation(fields: [outletId], references: [id])
  outletId  String
  station   Station
  startTime DateTime
  endTime   DateTime?
  shift     Shift
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt

  @@map("worker_shifts")
}

model Driver {
  id             String          @id @default(cuid())
  driver         User            @relation(fields: [driverId], references: [id])
  driverId       String
  outlet         Outlet          @relation(fields: [outletId], references: [id])
  outletId       String
  startTime      DateTime
  endTime        DateTime?
  createdAt      DateTime        @default(now())
  updatedAt      DateTime        @updatedAt
  pickupOrders   PickupOrder[]
  deliveryOrders DeliveryOrder[]

  @@map("drivers")
}

model Notification {
  id                  String               @id @default(cuid())
  title               String
  description         String
  createdAt           DateTime             @default(now())
  updatedAt           DateTime             @updatedAt
  userNotifications   UserNotification[]
  adminNotifications  AdminNotification[]
  workerNotifications WorkerNotification[]
  driverNotifications DriverNotification[]

  @@map("notifications")
}

model UserNotification {
  id             String        @id @default(cuid())
  user           User          @relation(fields: [userId], references: [id])
  userId         String
  notification   Notification? @relation(fields: [notificationId], references: [id])
  notificationId String?
  isRead         Boolean       @default(false)
  createdAt      DateTime      @default(now())
  updatedAt      DateTime      @updatedAt

  @@map("user_notifications")
}

model AdminNotification {
  id             String        @id @default(cuid())
  outletId       String
  notification   Notification? @relation(fields: [notificationId], references: [id])
  notificationId String?
  isRead         Boolean       @default(false)
  createdAt      DateTime      @default(now())
  updatedAt      DateTime      @updatedAt

  @@map("admin_notifications")
}

model WorkerNotification {
  id             String        @id @default(cuid())
  workerid       String
  notification   Notification? @relation(fields: [notificationId], references: [id])
  notificationId String?
  isRead         Boolean       @default(false)
  createdAt      DateTime      @default(now())
  updatedAt      DateTime      @updatedAt

  @@map("worker_notifications")
}

model DriverNotification {
  id             String        @id @default(cuid())
  driverId       String
  notification   Notification? @relation(fields: [notificationId], references: [id])
  notificationId String?
  isRead         Boolean       @default(false)
  createdAt      DateTime      @default(now())
  updatedAt      DateTime      @updatedAt

  @@map("driver_notifications")
}

model Sample {
  id        Int       @id @default(autoincrement())
  name      String
  deletedAt DateTime?
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt

  @@map("samples")
}

enum Shift {
  MORNING
  NOON
}

enum Token {
  EDIT_PASSWORD
  FORGOT_PASSWORD
  REGISTER_EMAIL
}

enum Role {
  CUSTOMER
  WORKER
  DRIVER
  OUTLET_ADMIN
  SUPER_ADMIN
}

enum Station {
  WASHING
  IRONING
  PACKING
}

enum OrderStatus {
  CANCELLED
  WAITING_FOR_PICKUP
  LAUNDRY_ON_THE_WAY
  ARRIVED_AT_OUTLET
  WASHING
  IRONING
  PACKING
  WAITING_FOR_PAYMENT
  READY_FOR_DELIVERY
  DELIVERY_ON_THE_WAY
  COMPLETED
}

enum PaymentStatus {
  PENDING
  SUCCESS
  CANCELLED
}
