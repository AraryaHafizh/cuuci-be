generator client {
  provider = "prisma-client"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                String             @id @default(cuid())
  name              String
  email             String             @unique
  password          String
  role              Role               @default(CUSTOMER)
  phoneNumber       String             @default("")
  emailVerified     Boolean            @default(false)
  verifiedAt        DateTime?
  profilePictureUrl String?
  provider          Provider           @default(CREDENTIALS)
  createdAt         DateTime           @default(now())
  updatedAt         DateTime           @updatedAt
  deletedAt         DateTime?
  // Address relation
  addresses         Address[]
  // Outlet admin relation
  adminOutlet       Outlet?            @relation("OutletAdmin")
  outletId          String?
  isOutletAdmin     Boolean            @default(false)
  // Worker relations
  workers           Worker[]
  // Customer orders
  orders            Order[]            @relation("CustomerOrders")
  // Driver relations
  drivers           Driver[]
  driverOrders      Order[]            @relation("DriverOrders")
  userTokens        UserToken[]
  attendances       Attendance[]
  userNotifications UserNotification[]
  pickupOrders      PickupOrder[]
  outlets           Outlet[]

  @@map("users")
}

model UserToken {
  type   Token
  user   User   @relation(fields: [userId], references: [id])
  userId String
  token  String @unique

  @@map("user_tokens")
}

model Address {
  id           String        @id @default(cuid())
  user         User          @relation(fields: [userId], references: [id])
  userId       String
  address      String
  latitude     String
  longitude    String
  isPrimary    Boolean       @default(false)
  isDeleted    Boolean       @default(false)
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt
  orders       Order[]
  pickupOrders PickupOrder[]

  @@map("addresses")
}

model Outlet {
  id        String    @id @default(cuid())
  outletId  String    @unique
  name      String
  address   String
  latitude  String
  longitude String
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  deletedAt DateTime?

  adminId String? @unique
  admin   User?   @relation("OutletAdmin", fields: [adminId], references: [id])

  orders             Order[]
  workers            Worker[]
  costumers          User[]
  drivers            Driver[]
  pickupOrders       PickupOrder[]
  orderWorkProcesses OrderWorkProcess[]

  @@map("outlets")
}

model Order {
  id                 String             @id @default(cuid())
  customer           User               @relation("CustomerOrders", fields: [customerId], references: [id])
  customerId         String
  outlet             Outlet             @relation(fields: [outletId], references: [id])
  outletId           String
  driver             User?              @relation("DriverOrders", fields: [driverId], references: [id])
  driverId           String?
  address            Address            @relation(fields: [addressId], references: [id])
  addressId          String
  // addressUser        String
  // addressLon         String
  // addressLat         String
  status             OrderStatus
  totalPrice         Int                @default(0)
  totalWeight        Int                @default(0)
  distance           Int                @default(0)
  orderItems         OrderItem[]
  payment            Payment?
  createdAt          DateTime           @default(now())
  updatedAt          DateTime           @updatedAt
  pickupTime         DateTime?
  deliveryTime       DateTime?
  invoiceUrl         String?
  pickupOrders       PickupOrder[]
  deliveryOrders     DeliveryOrder[]
  orderWorkProcesses OrderWorkProcess[]

  @@map("orders")
}

model OrderWorkProcess {
  id          String                 @id @default(cuid())
  workerId    String
  worker      Worker                 @relation(fields: [workerId], references: [id])
  orderId     String
  order       Order?                 @relation(fields: [orderId], references: [id])
  station     Station
  status      OrderWorkProcessStatus @default(PENDING)
  notes       String?
  completedAt DateTime?
  createdAt   DateTime               @default(now())
  updatedAt   DateTime               @updatedAt
  outlet      Outlet?                @relation(fields: [outletId], references: [id])
  outletId    String?

  @@map("order_work_processes")
}

model Note {
  id   String  @id @default(cuid())
  type Notes
  body String? @db.Text

  @@map("notes")
}

model LaundryItem {
  id         String      @id @default(cuid())
  name       String
  createdAt  DateTime    @default(now())
  updatedAt  DateTime    @updatedAt
  orderItems OrderItem[]

  @@map("laundry_items")
}

model OrderItem {
  id            String      @id @default(cuid())
  order         Order       @relation(fields: [orderId], references: [id])
  orderId       String
  laundryItem   LaundryItem @relation(fields: [laundryItemId], references: [id])
  laundryItemId String
  quantity      Int
  createdAt     DateTime    @default(now())
  updatedAt     DateTime    @updatedAt

  @@map("order_items")
}

model PickupOrder {
  id           String      @id @default(cuid())
  pickupNumber String      @unique
  status       OrderStatus
  customer     User        @relation(fields: [customerId], references: [id])
  customerId   String
  address      Address     @relation(fields: [addressId], references: [id])
  addressId    String
  outlet       Outlet      @relation(fields: [outletId], references: [id])
  outletId     String
  driver       Driver?     @relation(fields: [driverId], references: [id])
  driverId     String?
  order        Order?      @relation(fields: [orderId], references: [id])
  orderId      String?
  createdAt    DateTime    @default(now())
  updatedAt    DateTime    @updatedAt

  @@map("pickup_orders")
}

model DeliveryOrder {
  id             String      @id @default(cuid())
  deliveryNumber String      @unique
  status         OrderStatus
  driverId       String?
  driver         Driver?     @relation(fields: [driverId], references: [id])
  orderId        String?
  order          Order?      @relation(fields: [orderId], references: [id])
  createdAt      DateTime    @default(now())
  updatedAt      DateTime    @updatedAt

  @@map("delivery_orders")
}

model Payment {
  id            String        @id @default(cuid())
  order         Order         @relation(fields: [orderId], references: [id])
  orderId       String        @unique
  invoiceNumber String        @unique
  invoiceUrl    String?
  amount        Int
  method        String
  status        PaymentStatus
  paidAt        DateTime?
  createdAt     DateTime      @default(now())
  updatedAt     DateTime      @updatedAt

  @@map("payments")
}

model Attendance {
  id        String    @id @default(cuid())
  user      User      @relation(fields: [userId], references: [id])
  userId    String
  checkIn   DateTime
  checkOut  DateTime?
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt

  @@map("attendances")
}

model Worker {
  id                 String             @id @default(cuid())
  worker             User               @relation(fields: [workerId], references: [id])
  workerId           String             @unique
  outlet             Outlet             @relation(fields: [outletId], references: [id])
  outletId           String
  station            Station?
  startTime          DateTime?
  endTime            DateTime?
  shift              Shift
  createdAt          DateTime           @default(now())
  updatedAt          DateTime           @updatedAt
  orderWorkProcesses OrderWorkProcess[]

  @@map("workers")
}

model Driver {
  id                     String          @id @default(cuid())
  driver                 User            @relation(fields: [driverId], references: [id])
  driverId               String          @unique
  outlet                 Outlet          @relation(fields: [outletId], references: [id])
  outletId               String
  pickupOrders           PickupOrder[]
  pickupOrderId          String?
  currentPickupOrderId   String?
  deliveryOrders         DeliveryOrder[]
  currentDeliveryOrderId String?
  startTime              DateTime?
  endTime                DateTime?
  createdAt              DateTime        @default(now())
  updatedAt              DateTime        @updatedAt

  @@map("drivers")
}

model Notification {
  id                  String               @id @default(cuid())
  title               String
  description         String
  createdAt           DateTime             @default(now())
  updatedAt           DateTime             @updatedAt
  userNotifications   UserNotification[]
  adminNotifications  AdminNotification[]
  workerNotifications WorkerNotification[]
  driverNotifications DriverNotification[]

  @@map("notifications")
}

model UserNotification {
  id             String        @id @default(cuid())
  user           User          @relation(fields: [userId], references: [id])
  userId         String
  notification   Notification? @relation(fields: [notificationId], references: [id])
  notificationId String?
  isRead         Boolean       @default(false)
  createdAt      DateTime      @default(now())
  updatedAt      DateTime      @updatedAt

  @@map("user_notifications")
}

model AdminNotification {
  id             String        @id @default(cuid())
  adminId        String
  notification   Notification? @relation(fields: [notificationId], references: [id])
  notificationId String?
  isRead         Boolean       @default(false)
  createdAt      DateTime      @default(now())
  updatedAt      DateTime      @updatedAt

  @@map("admin_notifications")
}

model WorkerNotification {
  id             String        @id @default(cuid())
  workerId       String
  notification   Notification? @relation(fields: [notificationId], references: [id])
  notificationId String?
  isRead         Boolean       @default(false)
  createdAt      DateTime      @default(now())
  updatedAt      DateTime      @updatedAt

  @@map("worker_notifications")
}

model DriverNotification {
  id             String        @id @default(cuid())
  driverId       String
  notification   Notification? @relation(fields: [notificationId], references: [id])
  notificationId String?
  isRead         Boolean       @default(false)
  createdAt      DateTime      @default(now())
  updatedAt      DateTime      @updatedAt

  @@map("driver_notifications")
}

model Sample {
  id        Int       @id @default(autoincrement())
  name      String
  deletedAt DateTime?
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt

  @@map("samples")
}

enum Shift {
  MORNING
  NOON
}

enum Token {
  EDIT_PASSWORD
  FORGOT_PASSWORD
  REGISTER_EMAIL
}

enum Role {
  CUSTOMER
  WORKER
  DRIVER
  OUTLET_ADMIN
  SUPER_ADMIN
}

enum Notes {
  COMPLAINT
  BYPASS
  INSTRUCTION
}

enum Station {
  WASHING
  IRONING
  PACKING
}

enum OrderWorkProcessStatus {
  PENDING
  IN_PROCESS
  COMPLETED
  FAILED
}

enum OrderStatus {
  CANCELLED
  WAITING_FOR_PICKUP
  LAUNDRY_ON_THE_WAY
  ARRIVED_AT_OUTLET
  WASHING
  IRONING
  PACKING
  WAITING_FOR_PAYMENT
  READY_FOR_DELIVERY
  DELIVERY_ON_THE_WAY
  COMPLETED
}

enum PaymentStatus {
  PENDING
  SUCCESS
  CANCELLED
}

enum Provider {
  GOOGLE
  CREDENTIALS
}
